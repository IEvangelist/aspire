---
import Default from "@astrojs/starlight/components/Footer.astro";
import FooterLinks from "../FooterLinks.astro";
import MicrosoftFooter from "../MicrosoftFooter.astro";
import Expand from "../Expand.astro";

const isHomepage = Astro.locals.starlightRoute.id === "";
---

{
    isHomepage ? (
        <Default><slot /></Default>
        <FooterLinks />
        <Expand summary="Made with ðŸ’œ by Aspire">          
        </Expand>
        <MicrosoftFooter />
    ) : (
        <Default><slot /></Default>
        <FooterLinks />
        <MicrosoftFooter />
    )
}

<script is:inline>
    (() => {
        const base = window.location.hostname.replace(/^www\./, "");
        const treatSubdomainsAsInternal = true; // flip to false to treat subdomains as external

        const sameSite = (host) => {
            const h = host.replace(/^www\./, "");
            if (treatSubdomainsAsInternal) {
                return h === base || h.endsWith("." + base);
            }
            return h === base;
        };

        const applyExternalLinkAttrs = () => {
            document.querySelectorAll("a[href]").forEach((a) => {
                try {
                    const url = new URL(
                        a.getAttribute("href"),
                        window.location.origin,
                    );
                    // Only handle http/https
                    if (!/^https?:$/.test(url.protocol)) return;

                    if (!sameSite(url.hostname)) {
                        a.setAttribute("target", "_blank");
                        a.setAttribute("rel", "noopener noreferrer");
                        a.classList.add("external-link");

                        // (Optional a11y) announce new tab without clobbering existing label
                        const label = a.getAttribute("aria-label");
                        if (!label || !/\(opens in new tab\)/i.test(label)) {
                            a.setAttribute(
                                "aria-label",
                                (label ? label + " " : "") +
                                    "(opens in new tab)",
                            );
                        }
                    }
                } catch {
                    /* ignore invalid/relative oddities */
                }
            });
        };

        if (document.readyState === "loading") {
            document.addEventListener(
                "DOMContentLoaded",
                applyExternalLinkAttrs,
                { once: true },
            );
        } else {
            applyExternalLinkAttrs();
        }
    })();
</script>

<style>
</style>
